<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Bumblebee — Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=Montserrat:wght@200;300;400;500&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{--gold:#c9a84c;--gold-light:#e8c97a;--white:#f5f0e8;--gray:#888880;--black:#050505;--dark:#0d0d0d;--border:rgba(255,255,255,.07)}
html,body{height:100%;background:var(--black);color:var(--white);font-family:'Montserrat',sans-serif}
body{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px;position:relative;overflow:hidden}
body::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 30% 40%,rgba(201,168,76,.06),transparent 55%),radial-gradient(ellipse at 75% 70%,rgba(201,168,76,.03),transparent 50%)}
.lines{position:fixed;inset:0;pointer-events:none}
.line{position:absolute;top:0;bottom:0;width:1px;background:linear-gradient(to bottom,transparent,rgba(201,168,76,.06),transparent)}
.corner{position:fixed;width:32px;height:32px;pointer-events:none}
.corner::before,.corner::after{content:'';position:absolute;background:rgba(201,168,76,.25)}
.corner::before{width:1px;height:100%}.corner::after{width:100%;height:1px}
.tl{top:20px;left:20px}.tr{top:20px;right:20px;transform:scaleX(-1)}.bl{bottom:20px;left:20px;transform:scaleY(-1)}.br{bottom:20px;right:20px;transform:scale(-1)}

.login-box{position:relative;z-index:10;width:100%;max-width:420px;background:rgba(13,13,13,.95);border:1px solid var(--border);padding:48px 40px}
@media(max-width:480px){.login-box{padding:36px 24px}}
.login-logo{font-family:'Cormorant Garamond',serif;font-size:1.8rem;font-weight:300;letter-spacing:.35em;text-transform:uppercase;text-align:center;margin-bottom:6px}
.login-logo span{color:var(--gold);font-style:italic}
.login-subtitle{font-size:.48rem;letter-spacing:.45em;text-transform:uppercase;color:var(--gray);text-align:center;margin-bottom:40px}
.login-divider{width:40px;height:1px;background:var(--gold);margin:0 auto 40px;opacity:.4}

.form-group{margin-bottom:20px}
.form-label{font-size:.5rem;letter-spacing:.35em;text-transform:uppercase;color:var(--gold);display:block;margin-bottom:8px}
.form-input{width:100%;background:rgba(255,255,255,.03);border:1px solid var(--border);color:var(--white);padding:14px 16px;font-family:'Montserrat',sans-serif;font-size:.7rem;letter-spacing:.05em;outline:none;transition:border-color .3s;border-radius:0}
.form-input:focus{border-color:rgba(201,168,76,.4)}
.form-input::placeholder{color:var(--gray)}
.form-error{font-size:.52rem;color:#e05252;letter-spacing:.1em;margin-top:6px;display:none}

.login-btn{width:100%;padding:16px;background:var(--gold);border:none;color:var(--black);font-family:'Montserrat',sans-serif;font-size:.6rem;font-weight:500;letter-spacing:.38em;text-transform:uppercase;transition:all .3s;margin-top:8px;display:flex;align-items:center;justify-content:center;gap:10px}
.login-btn:hover{background:var(--gold-light)}
.login-btn:disabled{opacity:.6;cursor:not-allowed}

.error-box{background:rgba(229,57,53,.08);border:1px solid rgba(229,57,53,.2);padding:12px 16px;font-size:.58rem;color:#e05252;letter-spacing:.1em;text-align:center;margin-bottom:20px;display:none}
.back-link{display:block;text-align:center;margin-top:24px;font-size:.5rem;letter-spacing:.28em;text-transform:uppercase;color:var(--gray);text-decoration:none;transition:color .3s}
.back-link:hover{color:var(--gold)}

.spinner{width:16px;height:16px;border:2px solid rgba(0,0,0,.3);border-top-color:var(--black);border-radius:50%;animation:spin .7s linear infinite;flex-shrink:0}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>
<div class="lines">
  <div class="line" style="left:25%"></div>
  <div class="line" style="left:75%"></div>
</div>
<div class="corner tl"></div><div class="corner tr"></div>
<div class="corner bl"></div><div class="corner br"></div>

<div class="login-box">
  <div class="login-logo">Bumble<span>bee</span></div>
  <div class="login-subtitle">Administration</div>
  <div class="login-divider"></div>

  <div class="error-box" id="errorBox">Email ou mot de passe incorrect.</div>

  <div class="form-group">
    <label class="form-label">Email</label>
    <input type="email" class="form-input" id="inp-email" placeholder="admin@bumblebee.dz" autocomplete="email"/>
  </div>
  <div class="form-group">
    <label class="form-label">Mot de passe</label>
    <input type="password" class="form-input" id="inp-pass" placeholder="••••••••" autocomplete="current-password"/>
  </div>

  <button class="login-btn" id="loginBtn" onclick="doLogin()">
    <span id="btn-txt">Connexion</span>
  </button>
  <a href="../public/home.html" class="back-link">← Retour au site</a>
</div>

<script type="module">
import { auth, db } from '../firebase-config.js';
import { signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

window.doLogin = async function() {
  const email = document.getElementById('inp-email').value.trim();
  const pass = document.getElementById('inp-pass').value;
  const btn = document.getElementById('loginBtn');
  const errBox = document.getElementById('errorBox');
  errBox.style.display = 'none';

  if (!email || !pass) { errBox.textContent = 'Remplissez tous les champs.'; errBox.style.display = 'block'; return; }

  btn.disabled = true;
  btn.innerHTML = '<div class="spinner"></div>';

  try {
    const cred = await signInWithEmailAndPassword(auth, email, pass);
    const uid = cred.user.uid;

    // Check role in Firestore
    const snap = await getDoc(doc(db, 'users', uid));
    const role = snap.exists() ? snap.data().role : 'worker';

    if (role === 'owner') {
      window.location.href = 'owner/dashboard.html';
    } else {
      window.location.href = 'worker/dashboard.html';
    }
  } catch(err) {
    errBox.textContent = 'Email ou mot de passe incorrect.';
    errBox.style.display = 'block';
    btn.disabled = false;
    btn.innerHTML = '<span id="btn-txt">Connexion</span>';
  }
};

// Enter key
document.getElementById('inp-pass').addEventListener('keydown', e => {
  if (e.key === 'Enter') window.doLogin();
});
document.getElementById('inp-email').addEventListener('keydown', e => {
  if (e.key === 'Enter') document.getElementById('inp-pass').focus();
});

// Check already logged in
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
onAuthStateChanged(auth, async user => {
  if (user) {
    const snap = await getDoc(doc(db, 'users', user.uid));
    const role = snap.exists() ? snap.data().role : 'worker';
    window.location.href = role === 'owner' ? 'owner/dashboard.html' : 'worker/dashboard.html';
  }
});
</script>
</body>
</html>