<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Bumblebee â€” Personnel</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=Montserrat:wght@200;300;400;500&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="../admin.css"/>
<style>
.staff-grid{display:grid;grid-template-columns:1fr 360px;gap:32px;align-items:start}
@media(max-width:900px){.staff-grid{grid-template-columns:1fr}}
.staff-card{background:var(--dark);border:1px solid var(--border);padding:24px 20px;display:flex;align-items:center;gap:16px;margin-bottom:10px;transition:border-color .3s}
.staff-card:hover{border-color:rgba(201,168,76,.2)}
.staff-avatar{width:44px;height:44px;background:rgba(201,168,76,.1);border:1px solid rgba(201,168,76,.2);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0}
.staff-info{flex:1}
.staff-name{font-size:.72rem;letter-spacing:.06em;color:var(--white);margin-bottom:3px}
.staff-email{font-size:.56rem;letter-spacing:.1em;color:var(--gray)}
.staff-role{font-size:.48rem;letter-spacing:.28em;text-transform:uppercase;padding:4px 10px;border-radius:2px}
.role-owner{background:rgba(201,168,76,.1);border:1px solid rgba(201,168,76,.2);color:var(--gold)}
.role-worker{background:rgba(59,130,246,.1);border:1px solid rgba(59,130,246,.2);color:#60a5fa}
.add-card{background:rgba(201,168,76,.04);border:1px solid var(--border);padding:28px}
.add-title{font-family:'Cormorant Garamond',serif;font-size:1.2rem;font-weight:300;color:var(--gold);margin-bottom:20px}
.add-btn{width:100%;padding:14px;background:var(--gold);border:none;color:var(--black);font-family:'Montserrat',sans-serif;font-size:.58rem;font-weight:500;letter-spacing:.3em;text-transform:uppercase;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:8px;margin-top:8px}
.add-btn:hover{background:var(--gold-light)}
.add-btn:disabled{opacity:.6;cursor:not-allowed}
.success-box{background:rgba(37,211,102,.08);border:1px solid rgba(37,211,102,.2);padding:14px;font-size:.58rem;color:#25d366;letter-spacing:.1em;text-align:center;margin-bottom:16px;display:none}
.error-box{background:rgba(229,57,53,.08);border:1px solid rgba(229,57,53,.2);padding:14px;font-size:.58rem;color:#e05252;letter-spacing:.1em;text-align:center;margin-bottom:16px;display:none}
</style>
</head>
<body>
<div class="sidebar-overlay" id="overlay" onclick="closeSidebar()"></div>
<div class="toast" id="toast"></div>

<div class="admin-layout">
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-logo">
      <div class="logo">Bumble<span>bee</span></div>
      <div class="role-badge">ğŸ‘‘ PropriÃ©taire</div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-section">Principal</div>
      <a class="nav-item" href="dashboard.html"><span class="nav-icon">ğŸ“Š</span>Dashboard</a>
      <a class="nav-item" href="orders.html"><span class="nav-icon">ğŸ§¾</span>Commandes</a>
      <a class="nav-item" href="reservations.html"><span class="nav-icon">ğŸ“…</span>RÃ©servations</a>
      <div class="nav-section">Gestion</div>
      <a class="nav-item" href="inventory.html"><span class="nav-icon">ğŸ“¦</span>Inventaire</a> 
      <a class="nav-item" href="matches.html"><span class="nav-icon">âš½</span>Matchs</a>
      <a class="nav-item" href="customers.html"><span class="nav-icon">ğŸ‘¥</span>Clients</a>
      <a class="nav-item" href="staff.html"><span class="nav-icon">ğŸ‘¤</span>Personnel</a>
      <a class="nav-item" href="archive.html"><span class="nav-icon">ğŸ—‚ï¸</span>Archives</a>
      <div class="nav-section">Site</div>
      <a class="nav-item" href="../../public/home.html" target="_blank"><span class="nav-icon">ğŸŒ</span>Voir le site</a>
    </nav>
    <div class="sidebar-footer">
      <button class="logout-btn" onclick="doLogout()">ğŸšª DÃ©connexion</button>
    </div>
  </aside>

  <div class="main-content">
    <header class="main-header">
      <button class="sidebar-toggle" onclick="openSidebar()">â˜°</button>
      <h1>Gestion du <em>personnel</em></h1>
    </header>

    <div class="main-body">
      <div class="staff-grid">
        <!-- STAFF LIST -->
        <div>
          <div class="table-card" style="margin-bottom:0">
            <div class="table-header">
              <div class="table-title">Ã‰quipe <em>actuelle</em></div>
            </div>
            <div style="padding:16px" id="staff-list">
              <div class="empty-state"><div class="empty-icon">â³</div><div class="empty-msg">Chargement...</div></div>
            </div>
          </div>
        </div>

        <!-- ADD WORKER -->
        <div>
          <div class="add-card">
            <div class="add-title">â• Ajouter un employÃ©</div>
            <div class="success-box" id="success-box">Compte crÃ©Ã© avec succÃ¨s !</div>
            <div class="error-box" id="error-box"></div>
            <div class="a-form-group">
              <label class="a-form-label">Nom complet</label>
              <input type="text" class="a-form-input" id="inp-name" placeholder="PrÃ©nom Nom"/>
            </div>
            <div class="a-form-group">
              <label class="a-form-label">Email</label>
              <input type="email" class="a-form-input" id="inp-email" placeholder="worker@bumblebee.dz"/>
            </div>
            <div class="a-form-group">
              <label class="a-form-label">Mot de passe</label>
              <input type="password" class="a-form-input" id="inp-pass" placeholder="Min 6 caractÃ¨res"/>
            </div>
            <div class="a-form-group">
              <label class="a-form-label">RÃ´le</label>
              <select class="a-form-select" id="inp-role">
                <option value="worker">ğŸ‘¤ EmployÃ©</option>
                <option value="owner">ğŸ‘‘ PropriÃ©taire</option>
              </select>
            </div>
            <button class="add-btn" id="addBtn" onclick="addStaff()">
              <span id="add-txt">CrÃ©er le compte</span>
            </button>
            <p style="font-size:.5rem;color:var(--gray);letter-spacing:.1em;text-align:center;margin-top:12px;line-height:1.7">
              L'employÃ© pourra se connecter sur<br><strong style="color:var(--gold)">/admin/login.html</strong>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="module">
import { auth, db } from '../../firebase-config.js';
import { createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { collection, getDocs, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

let currentUser = null;

onAuthStateChanged(auth, async user => {
  if (!user) { window.location.href = '../login.html'; return; }
  const snap = await getDoc(doc(db,'users',user.uid));
  if (!snap.exists() || snap.data().role !== 'owner') { window.location.href = '../login.html'; return; }
  currentUser = user;
  loadStaff();
});

window.openSidebar=()=>{document.getElementById('sidebar').classList.add('open');document.getElementById('overlay').classList.add('show');};
window.closeSidebar=()=>{document.getElementById('sidebar').classList.remove('open');document.getElementById('overlay').classList.remove('show');};
window.doLogout=async()=>{await signOut(auth);window.location.href='../login.html';};

async function loadStaff(){
  const snap=await getDocs(collection(db,'users'));
  const staff=snap.docs.map(d=>({id:d.id,...d.data()}));
  const el=document.getElementById('staff-list');
  if(staff.length===0){el.innerHTML='<div class="empty-state"><div class="empty-icon">ğŸ‘¥</div><div class="empty-msg">Aucun employÃ© trouvÃ©.</div></div>';return;}
  el.innerHTML=staff.map(s=>`
    <div class="staff-card">
      <div class="staff-avatar">${s.role==='owner'?'ğŸ‘‘':'ğŸ‘¤'}</div>
      <div class="staff-info">
        <div class="staff-name">${s.name||'â€”'}</div>
        <div class="staff-email">${s.email||s.id}</div>
      </div>
      <span class="staff-role role-${s.role}">${s.role==='owner'?'PropriÃ©taire':'EmployÃ©'}</span>
    </div>`).join('');
}

window.addStaff=async()=>{
  const name=document.getElementById('inp-name').value.trim();
  const email=document.getElementById('inp-email').value.trim();
  const pass=document.getElementById('inp-pass').value;
  const role=document.getElementById('inp-role').value;
  const errBox=document.getElementById('error-box');
  const sucBox=document.getElementById('success-box');
  errBox.style.display='none';sucBox.style.display='none';
  if(!name||!email||!pass){errBox.textContent='Remplissez tous les champs.';errBox.style.display='block';return;}
  if(pass.length<6){errBox.textContent='Mot de passe trop court (min 6 caractÃ¨res).';errBox.style.display='block';return;}
  const btn=document.getElementById('addBtn');
  btn.disabled=true;btn.innerHTML='<div class="spinner"></div>';
  try{
    // Create auth account
    const {user}=await createUserWithEmailAndPassword(auth,email,pass);
    // Save to Firestore
    await setDoc(doc(db,'users',user.uid),{name,email,role,createdAt:new Date().toISOString()});
    sucBox.textContent=`âœ… Compte "${name}" crÃ©Ã© avec succÃ¨s !`;
    sucBox.style.display='block';
    document.getElementById('inp-name').value='';
    document.getElementById('inp-email').value='';
    document.getElementById('inp-pass').value='';
    loadStaff();
    // Re-sign in as owner (creating new user logs us out of current)
    // Note: in production use Admin SDK for this. For now just reload.
    setTimeout(()=>window.location.reload(),2000);
  }catch(err){
    errBox.textContent=err.message||'Erreur lors de la crÃ©ation du compte.';
    errBox.style.display='block';
  }finally{
    btn.disabled=false;btn.innerHTML='<span id="add-txt">CrÃ©er le compte</span>';
  }
};
</script>
</body>
</html>